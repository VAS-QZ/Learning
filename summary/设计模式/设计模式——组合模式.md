# 组合模式

定义：组合多个对象形成树的结构以表示“整体——部分”关系，对单个对象和组合对象进行无差别对待。组合模式是一种结构性模式

场景：文件夹中包含图片、文本文件和文件夹

这个场景中包含三个对象：图片、文件夹、文本文件，其中图片、文本文件和文件夹是聚合关系，于是我们产出了如下代码

```java
public class Folder {

    private List<ImageFile> imageFiles = new ArrayList<>();
    private List<TextFile> textFiles = new ArrayList<>();
    private List<Folder> folders = new ArrayList<>();

    private String name;

    public Folder(String name) {
        this.name = name;
    }

    public void addImageFile(ImageFile imageFile) {
        imageFiles.add(imageFile);
    }

    public void addTextFiles(TextFile textFile) {
        textFiles.add(textFile);
    }

    public void addFolder(Folder folder) {
        folders.add(folder);
    }

}

public class ImageFile {
    private String name;

    public ImageFile(String name) {
        this.name = name;
    }

}

public class TextFile {

    private String name;

    public TextFile(String name) {
        this.name = name;
    }
}
```

这个时候，我们对场景进行改变：现在我们增加一个文件种类——影音文件，按照上述代码逻辑会增加一个影音类，并且Folder类也需要做修改

```java
public class Folder {

    private List<ImageFile> imageFiles = new ArrayList<>();
    private List<TextFile> textFiles = new ArrayList<>();
    private List<Folder> folders = new ArrayList<>();
    //新增集合保存影音文件
    private List<TVFile> tvFiles = new ArrayList<>();

    private String name;

    public Folder(String name) {
        this.name = name;
    }

    public void addImageFile(ImageFile imageFile) {
        imageFiles.add(imageFile);
    }

    public void addTextFiles(TextFile textFile) {
        textFiles.add(textFile);
    }

    public void addFolder(Folder folder) {
        folders.add(folder);
    }
	//新增添加影音文件方法
    public void addTVFile(TVFile tvFile) {
        tvFiles.add(tvFile);
    }

}

public class TVFile {
    private String name;

    public TVFile(String name) {
        this.name = name;
    }
    
}
```

我们在增加一个文件种类的时候对原有的代码进行了更改，违反了开闭原则。那么我们怎么做才能保证开闭原则呢，也就是不对Folder类进行修改呢，最常见的方法就是根据依赖倒置原则进行修改，即使程序面向接口编程。于是乎我们新增构件接口Component，并使得上述类都实现该接口，并修改相应程序

```java
public interface Component {
}

public class Folder implements Component {

    private List<Component> files = new ArrayList<>();

    private String name;

    public Folder(String name) {
        this.name = name;
    }

    public void addFile(ImageFile imageFile) {
        files.add(imageFile);
    }

}

public class ImageFile implements Component {
    
    private String name;

    public ImageFile(String name) {
        this.name = name;
    }

}

public class TextFile implements Component  {

    private String name;

    public TextFile(String name) {
        this.name = name;
    }
    
}
```

接下来我们再添加一个文件种类时就只需要增加一个实现了Component接口的类就可以了，符合开闭原则和依赖倒置原则

## 总结

在组合模式中，一共存在三类角色

- Component：组合部件，为要组合的对象提供统一的接口，在上述程序中对应Component接口
- Leaf：叶子，标识叶子结点，叶子结点不能有子节点，在上述代码中对应TextFile和ImageFile
- Composite：枝干节点，可以存储部件，在上述代码中对应Folder

类图如下

![](./pic/composite.png)

